# ç½‘é¡µå›¾ç‰‡é‡‡é›†åŠ©æ‰‹

ä¸€ä¸ªå¼ºå¤§çš„ Chrome æ’ä»¶ï¼Œç”¨äºç½‘é¡µå›¾ç‰‡é‡‡é›†ã€æˆªå›¾å’Œå¤„ç†, å¹¶åŒ…å«äº†å®ç”¨ SDK ç¨‹åºï¼Œä½ å¯ä»¥æ›´æ–¹ä¾¿çš„å°†æ”¶é›†çš„ç»“æœå›ä¼ åˆ°ä½ çš„ç½‘ç«™ã€‚

# å…è´£å£°æ˜

æœ¬æ’ä»¶ä»…ä½œä¸ºæŠ€æœ¯å·¥å…·ï¼Œä¸ºç”¨æˆ·æä¾›å†…å®¹é‡‡é›†å’Œåˆ†æåŠŸèƒ½ã€‚è¯·æ³¨æ„ï¼š

1. èµ„æºå½’å±

- é€šè¿‡æœ¬æ’ä»¶é‡‡é›†çš„æ‰€æœ‰å›¾ç‰‡ã€æ–‡æœ¬ç­‰èµ„æºçš„ç‰ˆæƒå½’åŸä½œè€…/ç½‘ç«™æ‰€æœ‰
- æ’ä»¶å¼€å‘è€…ä¸è¿™äº›é‡‡é›†çš„èµ„æºå†…å®¹æ— å…³ï¼Œä¸å¯¹å…¶è´Ÿæœ‰ä»»ä½•è´£ä»»
- ç”¨æˆ·ä½¿ç”¨æœ¬æ’ä»¶é‡‡é›†çš„ä»»ä½•å†…å®¹ä¸æ’ä»¶ä½œè€…æ— å…³

2. ä½¿ç”¨è´£ä»»

- ç”¨æˆ·åº”å½“éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„å’ŒåŸç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾
- ç”¨æˆ·å¯¹ä½¿ç”¨æœ¬æ’ä»¶é‡‡é›†çš„å†…å®¹æ‰¿æ‹…å…¨éƒ¨è´£ä»»
- è¯·å‹¿å°†æœ¬æ’ä»¶ç”¨äºä»»ä½•éæ³•æˆ–ä¾µæƒè¡Œä¸º

3. ç‰ˆæƒå£°æ˜

- ç”¨æˆ·åœ¨ä½¿ç”¨é‡‡é›†çš„å†…å®¹æ—¶ï¼Œåº”å½“éµå®ˆåŸå†…å®¹çš„ç‰ˆæƒè§„å®š
- å»ºè®®åœ¨ä½¿ç”¨é‡‡é›†å†…å®¹æ—¶æ³¨æ˜æ¥æº
- å¦‚æ¶‰åŠå•†ä¸šç”¨é€”ï¼Œè¯·äº‹å…ˆè·å¾—åŸä½œè€…/ç½‘ç«™æˆæƒ

æœ¬æ’ä»¶ä»…æä¾›æŠ€æœ¯æ”¯æŒï¼Œä¸å¯¹ç”¨æˆ·çš„å…·ä½“ä½¿ç”¨è¡Œä¸ºåŠå…¶åæœæ‰¿æ‹…è´£ä»»ã€‚å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·è”ç³»åŸå†…å®¹çš„ç‰ˆæƒæ‰€æœ‰è€…ã€‚

## 1. æ’ä»¶åŠŸèƒ½

### ä¸»è¦åŠŸèƒ½

- ğŸ–¼ï¸ ç½‘é¡µå›¾ç‰‡é‡‡é›†
- ğŸ“¸ åŒºåŸŸæˆªå›¾
- ğŸ“± å¯è§†åŒºåŸŸæˆªå›¾
- ğŸ–¥ï¸ å…¨é¡µé¢æˆªå›¾
- ğŸ’¾ ä¸€é”®ä¿å­˜

### ä½¿ç”¨æ–¹æ³•

1. **å®‰è£…æ’ä»¶**

   ```bash
   # 1. å…‹éš†ä»“åº“
   git clone [repository-url]

   # 2. åœ¨ Chrome ä¸­åŠ è½½æ’ä»¶
   - æ‰“å¼€ Chrome æ‰©å±•ç®¡ç†é¡µé¢ (chrome://extensions/)
   - å¯ç”¨"å¼€å‘è€…æ¨¡å¼"
   - ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
   - é€‰æ‹©é¡¹ç›®æ–‡ä»¶å¤¹[plugin]
   ```

2. **ä½¿ç”¨æ’ä»¶**

   - ç‚¹å‡»æ’ä»¶å›¾æ ‡æ‰“å¼€åŠŸèƒ½é¢æ¿
   - é€‰æ‹©éœ€è¦çš„åŠŸèƒ½ï¼š
     - æ‚¬æµ®é‡‡é›†ï¼šä½¿ç”¨æ‚¬æµ®æŒ‰é’®é‡‡é›†å›¾ç‰‡
     - æ‹–æ”¾æ¨¡å¼ï¼šç›´æ¥æ‹–æ‹½ç½‘é¡µå›¾ç‰‡
     - æˆªå›¾æ¨¡å¼ï¼šæ¡†é€‰åŒºåŸŸæˆªå›¾
     - å…¨é¡µé¢æˆªå›¾ï¼šæ•è·æ•´ä¸ªé¡µé¢
     - æ‰¹é‡é‡‡é›†å›¾ç‰‡ï¼šæ‰¹é‡é‡‡é›†æ•´ä¸ªé¡µé¢çš„å¯ç”¨å›¾ç‰‡
   - å³é”®ç½‘é¡µå›¾ç‰‡å¯ä»¥ç›´æ¥é‡‡é›†

3. **ä¿®æ”¹ç¯å¢ƒå˜é‡**

   - plugin\env.js

   ```javascript
   // å…±äº«çš„é…ç½®
   const Config = {
     TARGET_ORIGIN: "http://127.0.0.1:5500/example/index.html",
   };
   ```

![](./docs/static/pluginv2.png)

## 2. ç¤ºä¾‹é¡µé¢

### åŠŸèƒ½å±•ç¤º

- æ‚¬æµ®é‡‡é›†
  ![](./docs/static/floatCollect.png)

- æ‰¹é‡é‡‡é›†
  ![](./docs/static/collectAll.png)

- å®æ—¶é¢„è§ˆé‡‡é›†çš„å›¾ç‰‡
  ![](./docs/static/Snipaste_2024-12-06_14-13-55.png)

### ä½¿ç”¨æ–¹æ³•

1. æ‰“å¼€ `example\index.html` live server è¿›è¡Œæµ‹è¯•
2. ç¤ºä¾‹é¡µé¢ä¼šè‡ªåŠ¨è¿æ¥åˆ°æ’ä»¶
3. å¯ä»¥å®æ—¶æŸ¥çœ‹é‡‡é›†ç»“æœ

## 3. ChromeImageHunterSDK

### åŠŸèƒ½ç‰¹ç‚¹

- æä¾›æ ‡å‡†åŒ–çš„æ¥å£
- æ”¯æŒ TypeScript
- æ¨¡å—åŒ–è®¾è®¡
- å®Œæ•´çš„ç±»å‹å®šä¹‰
- æ”¯æŒ base64 å’Œ TypedArray ä¸¤ç§å›¾ç‰‡æ•°æ®æ ¼å¼
- è‡ªåŠ¨å¤„ç†æ¶ˆæ¯é€šä¿¡

### å®‰è£…ä½¿ç”¨

```bash
cd sdk
pnpm install
pnpm run build
```

### API ç¤ºä¾‹

```typescript
import ChromeImageHunterSDK from "../sdk/dist/index.js";

const sdk = new ChromeImageHunterSDK({
  onConnect: () => {
    console.log("æ’ä»¶å·²è¿æ¥");
  },
  onDisconnect: () => {
    console.log("æ’ä»¶å·²æ–­å¼€");
  },
  onImage: ({ blob, message }) => {
    // blob: å›¾ç‰‡çš„ Blob å¯¹è±¡
    // message: åŒ…å«å›¾ç‰‡æ¥æºã€æ—¶é—´æˆ³ç­‰å®Œæ•´æ¶ˆæ¯
    console.log("æ”¶åˆ°å›¾ç‰‡:", blob);
    console.log("å›¾ç‰‡ä¿¡æ¯:", message);

    // ä½¿ç”¨ç¤ºä¾‹ï¼š
    const imageUrl = URL.createObjectURL(blob);
    const img = document.createElement("img");
    img.src = imageUrl;
    document.body.appendChild(img);
  },
});

// æ£€æŸ¥è¿æ¥çŠ¶æ€
console.log("æ˜¯å¦å·²è¿æ¥:", sdk.isConnected());

// ä¸å†ä½¿ç”¨æ—¶é”€æ¯å®ä¾‹
sdk.destroy();
```

### SDK ç±»å‹å®šä¹‰

```typescript
// æ¶ˆæ¯æ¥å£
interface ChromeImageHunterSDKMessage {
  type: "FROM_EXTENSION" | "FROM_CONTENT";
  action: string;
  timestamp: number;
  sourceUrl: string;
  targetOrigin: string;
  taskType: string;
  base64?: string;
  typedArray?: number[];
}

// SDK é…ç½®æ¥å£
interface ChromeImageHunterSDKOptions {
  onConnect?: () => void;
  onDisconnect?: () => void;
  onImage?: (option: {
    blob: Blob;
    message: ChromeImageHunterSDKMessage;
  }) => void;
}
```

# TODO

- [âœ”] é‡‡é›†å›¾ç‰‡æ¥æºä¿¡æ¯å’Œå…ƒæ•°æ®
- [ ] å‘å¸ƒ ChromeImageHunterSDK
- [âœ”] ä½¿ç”¨ typedArray æ–¹æ¡ˆæ›¿ä»£ base64 æ–¹æ¡ˆ,èŠ‚çœä½“ç§¯
